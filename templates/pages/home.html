{% extends "base.html" %}
{% block title %}
  this is amazing
{% endblock title %}
this is amazing
{% block content %}
<div class="row text-center">
    <div class="col">
        <h1>Welcome to tweetme2</h1>
    </div>
</div>
    <div class="row mb-3">
        <div class="col-md-4 mx-auto col-10">
            <form class="form" method="POST" action="/create-tweet">
            {% csrf_token %}
            <input type="hidden" value="/" name="next"/>
            <textarea class="form-control" name="content" placeholder="Your tweet tatata"></textarea>
            <button class="btn btn-primary" type="submit">Tweet</button>

            </form>
        </div>
    </div>


  <div class="row " id="tweets">
      Loading ...
  </div>

  <script>
      const  tweetsElement = document.getElementById('tweets')
    //   tweetsElement.innerHTML = 'Loading ...'

    //   var el1 = '<h1>Hi there 1</h1>'
    //   var el2 = '<h1>Hi there 2</h1>'
    //   var el3 = '<h1>Hi there 3</h1>'
    
    //   tweetsElement.innerHTML= el1+el2+el3
      const xhr = new XMLHttpRequest()
      const method = "GET"
      const url = '/tweets'
      const responseType = "json"

      function handleDidLike(tweet_id, currentCount){
            console.log(tweet_id, currentCount)

            return 
      }
      function LikeBtn(tweet){
            return "<button class='btn btn-primary' onclick=handleDidLike("+tweet.id+","+ tweet.likes+")>"+tweet.likes+" Like</button>"
      }


      function formatTweetElement(tweet){        
        var formatedTweet = "<div class='col-12 col-md-10 mx-auto  border-bottom border-top py-3 tweet' id='tweet-'"+tweet.id+">"
            + "<p>" + tweet.content + 
                "</p><div class='btn-group'>"+LikeBtn(tweet)+
                '</div></div>'
        return formatedTweet
      }

      xhr.responseType = responseType
      xhr.open(method, url)
      xhr.onload = function(){
          const serverResponse = xhr.response 
          const listedItems = serverResponse.response
          var finalTweetStr = ''
          var i ;
          for(i=0; i<listedItems.length; i++){
              var tweetObj = listedItems[i]
             var currentItem = formatTweetElement(tweetObj)
                finalTweetStr += currentItem
          }
          tweetsElement.innerHTML = finalTweetStr
        //   console.log(listedItems)

      }
      xhr.send()
  </script>

{% endblock content %}
